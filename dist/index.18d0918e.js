(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var t,n,i,o=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),console.log("Dep 创建了",this),this.subs=[]}var n,i,o;return n=t,(i=[{key:"addSub",value:function(e){this.subs.push(e)}},{key:"notify",value:function(){this.subs.forEach((function(e){e.update()}))}}])&&e(n.prototype,i),o&&e(n,o),Object.defineProperty(n,"prototype",{writable:!1}),t}();i=null,(n="target")in(t=o)?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i;var r=[];function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),console.log("Watcher 创建了"),this.vm=t,this.exp=n,this.cb=i,this.value=this.get(),console.log(this.value)}var t,n,i;return t=e,n=[{key:"update",value:function(){this.run()}},{key:"run",value:function(){var e=this.vm.data[this.exp],t=this.value;e!==t&&(this.value=e,this.cb.call(this.vm,e,t))}},{key:"get",value:function(){var e;e=this,o.target&&r.push(o.target),o.target=e;var t=this.vm.data[this.exp];return o.target=r.pop(),t}}],n&&a(t.prototype,n),i&&a(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.vm=n,this.el=document.querySelector(t),this.fragment=null,this.init()}var t,n,i;return t=e,n=[{key:"init",value:function(){if(!this.el)throw new Error("Dom元素不存在");this.fragment=this.nodeToFragment(this.el),this.compileElement(this.fragment),this.el.appendChild(this.fragment)}},{key:"nodeToFragment",value:function(e){for(var t=document.createDocumentFragment(),n=e.firstChild;n;)t.appendChild(n),n=e.firstChild;return t}},{key:"compileElement",value:function(e){for(var t=e.childNodes,n=/\{\{(.*)\}\}/,i=0;i<t.length;i++){var o=t[i],r=o.textContent;console.log(o.nodeType),this.isElementNode(o)?this.compile(o):this.isTextNode(o)&&n.test(r)&&this.compileText(o,n.exec(r)[1]),o.childNodes&&o.childNodes.length&&this.compileElement(o)}}},{key:"compile",value:function(e){for(var t=e.attributes,n=0;n<t.length;n++){var i=t[n],o=i.name;if(this.isDirective(o)){var r=i.value,a=o.substring(2);console.log(a),this.isEventDirective(a)?this.compileEvent(e,r,a):this.compileModel(e,this.vm,r,a),e.removeAttribute(o)}}}},{key:"compileText",value:function(e,t){var n=this,i=this.vm[t];this.updateText(e,i),new l(this.vm,t,(function(t){n.updateText(e,t)}))}},{key:"compileEvent",value:function(e,t,n){var i=n.split(":")[1];console.log(i,"eventType");var o=this.vm.methods&&this.vm.methods[t];i&&o&&e.addEventListener(i,o.bind(this.vm),!1)}},{key:"compileModel",value:function(e,t,n,i){var o=this,r=this.vm[n];this.modelUpdater(e,r),new l(this.vm,n,(function(t){o.modelUpdater(e,t)})),e.addEventListener("input",(function(e){var t=e.target.value;r!==t&&(o.vm[n]=t,r=t)}))}},{key:"updateText",value:function(e,t){e.textContent=void 0===t?"":t}},{key:"modelUpdater",value:function(e,t,n){e.value=void 0===t?"":t}},{key:"isTextNode",value:function(e){return 3==e.nodeType}},{key:"isDirective",value:function(e){return 0==e.indexOf("v-")}},{key:"isElementNode",value:function(e){return 1==e.nodeType}},{key:"isEventDirective",value:function(e){return 0===e.indexOf("on:")}}],n&&u(t.prototype,n),i&&u(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}var f=Array.prototype,v=Object.create(f);function h(e){if("object"!==c(e)||null==e)return e;for(var t in Array.isArray(e)&&(e.__proto__=v),e)p(e,t,e[t])}function p(e,t,n){h(n);var i=new o;Object.defineProperty(e,t,{get:function(){return o.target&&i.addSub(o.target),n},set:function(e){n!==e&&(n=e,console.log("已经被监听了"),i.notify())}})}function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}["push","pop"].forEach((function(e){v[e]=function(){var t;console.log("shitugengxin"),(t=f[e]).call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}}));var y=function(){function e(t){var n=this;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.vm=this,this.data=t.data,this.methods=t.methods,Object.keys(this.data).forEach((function(e){n.proxyKeys(e)})),h(t.data),new s(t.el,this.vm),this}var t,n,i;return t=e,n=[{key:"proxyKeys",value:function(e){var t=this;Object.defineProperty(this,e,{get:function(){return t.data[e]},set:function(n){t.data[e]=n}})}}],n&&d(t.prototype,n),i&&d(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();new y({el:"#app",data:{title:"aaa",name:"bbb",um:"123"},methods:{asd:function(){console.log(123)}}}),"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("/service-worker.js").then((function(){console.log("success")})).catch((function(){console.log("false")}))}))})();